(this["webpackJsonpbloglist-frontend"]=this["webpackJsonpbloglist-frontend"]||[]).push([[0],{168:function(e,t,n){},191:function(e,t,n){"use strict";n.r(t);var r=n(8),o=n(0),a=n(41),c=n.n(a),i=n(27),s=n(51),u=n(10),l=(n(168),n(207)),d=Object(i.b)((function(e){return console.log("Notification - mapStateToProps",e),{notification:e.notification}}))((function(e){return e.notification.text?Object(r.jsx)(l.a,{positive:!e.notification.isError,error:e.notification.isError,children:e.notification.text}):null})),f=n(210),g=n(206),j=function(e,t){return e.users.find((function(e){return e.id===t.userid}))},b=Object(i.b)((function(e,t){return{blogs:e.blogs,user:j(e,t)}}))((function(e){return console.log("UserView props",e),void 0===e.user?null:(console.log("props.user",e.user),Object(r.jsxs)("div",{children:[Object(r.jsx)(f.a,{as:"h2",children:e.user.name}),Object(r.jsx)(f.a,{as:"h3",children:"Added blogs"}),Object(r.jsx)(g.a,{bulleted:!0,children:e.user.blogs.map((function(e){return Object(r.jsx)(g.a.Item,{children:Object(r.jsx)(s.b,{to:"/blogs/".concat(e.id),children:e.title})},e.id)}))})]}))})),p=n(12),O=n.n(p),h=n(29),v=n(40),x=n(147),m=function(e){var t=Object(o.useState)(""),n=Object(x.a)(t,2),r=n[0],a=n[1];return{type:e,value:r,onChange:function(e){a(e.target.value)},reset:function(){a("")}}},w={text:"",isError:!1},y=function(e,t,n){return function(r){r({type:"SET_NOTIF",data:{text:e,isError:t}}),setTimeout((function(){r(E())}),1e3*n)}},E=function(){return{type:"RESET_NOTIF"}},I=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w,t=arguments.length>1?arguments[1]:void 0;switch(console.log("notificationReducer",e,t),t.type){case"SET_NOTIF":return t.data;case"RESET_NOTIF":return"";default:return e}},L=n(34),S=n.n(L),T="/api/blogs",k=null,N=function(){return S.a.get(T).then((function(e){return e.data}))},_=function(e){var t={headers:{Authorization:k}};return console.log("Create",e,t),S.a.post(T,e,t).then((function(e){return e.data}))},B=function(e,t){return S.a.put("".concat(T,"/").concat(e),t).then((function(e){return e.data}))},G=function(e){var t={data:e,headers:{Authorization:k}};return console.log("Remove",e,t),S.a.delete("".concat(T,"/").concat(e.id),t).then((function(e){console.log(e.data)}))},U=function(e){k="bearer ".concat(e),console.log("blog service set token",k)},R=function(e){return function(t){U(e.token),t({type:"SET_LOGIN",data:e})}},A=function(){return function(e){U(""),e({type:"RESET_LOGIN"})}},P=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_LOGIN":return t.data;case"RESET_LOGIN":return null;default:return e}},z={login:function(){var e=Object(h.a)(O.a.mark((function e(t){var n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.a.post("/api/login",t);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},W=n(209),D=n(204),F=n(212),C=n(208),J=Object(u.e)((function(e){var t=m("text"),n=m("password"),o=Object(v.a)({},t);delete o.reset;var a=Object(v.a)({},n);delete a.reset;var c=function(){var r=Object(h.a)(O.a.mark((function r(o){var a;return O.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o.preventDefault(),r.prev=1,console.log("handleLogin",t.value,n.value),r.next=5,z.login({username:t.value,password:n.value});case 5:a=r.sent,console.log("loggedUser",a),a&&(window.localStorage.setItem("loggedUser",JSON.stringify(a)),e.setLogin(a),t.reset(),n.reset(),console.log("User logged in",t,n,e.login),e.history.push("/")),r.next=14;break;case 10:r.prev=10,r.t0=r.catch(1),console.log("handleLogin exception",r.t0),e.setNotification("Wrong username or password",!0,5);case 14:case"end":return r.stop()}}),r,null,[[1,10]])})));return function(e){return r.apply(this,arguments)}}();return Object(r.jsx)(W.a,{textAlign:"center",style:{height:"100vh"},verticalAlign:"top",children:Object(r.jsxs)(W.a.Column,{style:{maxWidth:450},children:[Object(r.jsx)(f.a,{as:"h2",textAlign:"center",children:" Login  "}),Object(r.jsx)(D.a,{size:"large",onSubmit:c,children:Object(r.jsxs)(F.a,{stacked:!0,children:[Object(r.jsx)(D.a.Input,Object(v.a)(Object(v.a)({fluid:!0,icon:"user",iconPosition:"left",name:"Username"},o),{},{"data-cy":"username"})),Object(r.jsx)(D.a.Input,Object(v.a)(Object(v.a)({fluid:!0,icon:"lock",iconPosition:"left",type:"password",name:"Password"},a),{},{"data-cy":"password"})),Object(r.jsx)(C.a,{fluid:!0,size:"large","data-cy":"submit",children:"Login"})]})})]})})})),M={setNotification:y,setLogin:R},V=Object(i.b)((function(e){return{login:e.login,notification:e.notification}}),M)(J),q=n(205),H={resetLogin:A},K=Object(i.b)((function(e){return{login:e.login}}),H)((function(e){console.log("props.login",e.login);return Object(r.jsxs)(q.a,{children:[Object(r.jsx)(q.a.Item,{children:Object(r.jsx)(s.b,{to:"/","data-cy":"blogs-link",children:"blogs"})}),Object(r.jsx)(q.a.Item,{children:Object(r.jsx)(s.b,{to:"/users","data-cy":"users-link",children:"users"})}),Object(r.jsx)(q.a.Menu,{position:"right",children:e.login?Object(r.jsxs)(r.Fragment,{children:[Object(r.jsxs)(q.a.Item,{children:[" ",e.login.name.first," logged in"]}),Object(r.jsx)(q.a.Item,{children:Object(r.jsx)(C.a,{onClick:function(){window.localStorage.removeItem("loggedUser"),e.resetLogin()},children:"logout"})})]}):null})]})})),Q=[],X=function(e){return function(){var t=Object(h.a)(O.a.mark((function t(n){return O.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,B(e.id,e);case 2:n({type:"UPDATE_BLOG",data:e});case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},Y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q,t=arguments.length>1?arguments[1]:void 0;switch(console.log("blogReducer",e,t),t.type){case"INIT_BLOGS":return console.log("INIT_BLOGS",e.concat(t.data)),t.data;case"NEW_BLOG":return console.log("NEW_BLOG",e.concat(t.data)),e.concat(t.data);case"UPDATE_BLOG":return console.log("UPDATE_BLOG",e.concat(t.data)),e.map((function(e){return e.id===t.data.id?t.data:e}));case"REMOVE_BLOG":return e.filter((function(e){return e.id!==t.data.id}));default:return e}},Z="/api/users",$=function(){return S.a.get(Z).then((function(e){return e.data}))},ee=[],te=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ee,t=arguments.length>1?arguments[1]:void 0;switch(console.log("userReducer",e,t),t.type){case"INIT_USERS":return t.data;default:return e}},ne={initializeBlogs:function(){return function(){var e=Object(h.a)(O.a.mark((function e(t){var n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N();case 2:n=e.sent,t({type:"INIT_BLOGS",data:n});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},createBlog:function(e){var t=e.title,n=e.author,r=e.url;return function(){var e=Object(h.a)(O.a.mark((function e(o){var a;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_({title:t,author:n,url:r,likes:0});case 2:a=e.sent,o({type:"NEW_BLOG",data:a});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},updateBlog:X,likeBlog:function(e){var t=Object(v.a)(Object(v.a)({},e),{},{likes:e.likes+1});return X(t)},removeBlog:function(e){return function(){var t=Object(h.a)(O.a.mark((function t(n){return O.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,G(e);case 2:n({type:"REMOVE_BLOG",data:e});case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},initializeUsers:function(){return function(){var e=Object(h.a)(O.a.mark((function e(t){var n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$();case 2:n=e.sent,t({type:"INIT_USERS",data:n});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},setLogin:R,resetLogin:A,setNotification:y},re=Object(i.b)((function(e){return console.log("APP - mapStateToProps",e),{blogs:e.blogs,login:e.login,notification:e.notification}}),ne)((function(e){return Object(o.useEffect)((function(){var t=window.localStorage.getItem("loggedUser");if(t){console.log("load user",t);var n=JSON.parse(t);e.setLogin(n)}}),[]),Object(o.useEffect)((function(){console.log("get all blogs"),e.initializeBlogs(),e.initializeUsers()}),[]),console.log("check user",e.login),Object(r.jsx)("div",{children:Object(r.jsxs)(s.a,{children:[Object(r.jsx)(K,{}),Object(r.jsx)(d,{}),Object(r.jsx)(u.a,{exact:!0,path:"/users/:id",render:function(e){var t=e.match;return Object(r.jsx)(b,{userid:t.params.id})}}),Object(r.jsx)(u.a,{exact:!0,path:"/login",render:function(){return Object(r.jsx)(V,{})}})]})})})),oe=n(59),ae=n(203),ce=n(144),ie=n(145),se=Object(oe.combineReducers)({notification:I,blogs:Y,users:te,login:P}),ue=Object(oe.createStore)(se,Object(ie.composeWithDevTools)(Object(oe.applyMiddleware)(ce.a)));c.a.render(Object(r.jsx)(i.a,{store:ue,children:Object(r.jsx)(ae.a,{children:Object(r.jsx)(re,{})})}),document.getElementById("root"))}},[[191,1,2]]]);
//# sourceMappingURL=main.8c2ed8f6.chunk.js.map